<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8" />
  <title>Recovai | AntrenÃ¶r Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      margin: 0;
      font-family: Inter, Arial, sans-serif;
      background: #f4f6fa;
      color: #222;
    }

    header {
      background: #1f3c88;
      color: #fff;
      padding: 20px 32px;
      font-size: 20px;
      font-weight: 600;
    }

    .container {
      padding: 24px 32px;
    }

    /* KPI CARDS */
    .kpi-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 28px;
    }

    .kpi-card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
    }

    .kpi-title {
      font-size: 13px;
      color: #666;
      margin-bottom: 6px;
    }

    .kpi-value {
      font-size: 26px;
      font-weight: 700;
    }

    .kpi-card {
  display: flex;
  align-items: center;
  gap: 16px;
  color: #fff;
  border-radius: 14px;
  padding: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.12);
}

.kpi-icon {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  background: rgba(255,255,255,0.2);
  display: flex;
  align-items: center;
  justify-content: center;
}

.kpi-icon svg {
  width: 26px;
  height: 26px;
  fill: #fff;
}

.kpi-content {
  flex: 1;
}

.kpi-title {
  font-size: 13px;
  opacity: 0.9;
  margin-bottom: 4px;
}

.kpi-value {
  font-size: 28px;
  font-weight: 700;
}

/* RENK TEMALARI */
.kpi-blue {
  background: linear-gradient(135deg, #1f3c88, #3a6ee8);
}

.kpi-red {
  background: linear-gradient(135deg, #c0392b, #e74c3c);
}

.kpi-green {
  background: linear-gradient(135deg, #2e8b57, #3cb371);
}

.kpi-purple {
  background: linear-gradient(135deg, #6f42c1, #9b59b6);
}


    /* CHART */
    .chart-box {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 28px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
    }

    .chart-placeholder {
      height: 220px;
      background: linear-gradient(135deg, #e9ecf5, #f9fbff);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #888;
      font-size: 14px;
    }

    /* TABLE */
    .table-box {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    th {
      text-align: left;
      color: #555;
      font-weight: 600;
      border-bottom: 1px solid #eee;
      padding: 12px 8px;
    }

    td {
      padding: 12px 8px;
      border-bottom: 1px solid #f1f1f1;
    }

    .status-good {
      color: #2e8b57;
      font-weight: 600;
    }

    .status-medium {
      color: #d97706;
      font-weight: 600;
    }

    .status-risk {
      color: #c0392b;
      font-weight: 600;
    }

    .trend-up {
      color: #2e8b57;
    }

    .trend-down {
      color: #c0392b;
    }

    .trend-stable {
      color: #555;
    }

    @media (max-width: 1000px) {
      .kpi-row {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 600px) {
      .kpi-row {
        grid-template-columns: 1fr;
      }
    }

    .chart-row {
  display: grid;
  grid-template-columns: 2fr 1fr; /* sol bÃ¼yÃ¼k, saÄŸ donut */
  gap: 24px;
  margin-bottom: 28px;
}

/* Mobil uyum */
@media (max-width: 900px) {
  .chart-row {
    grid-template-columns: 1fr;
  }
}
  </style>
</head>

<body>

  <header>
    Recovai â€¢ AntrenÃ¶r Dashboard
  </header>

  <div class="container">

    <!-- KPI CARDS -->
    <div class="kpi-row">
  <!-- Toplam Sporcu -->
  <div class="kpi-card kpi-blue">
    <div class="kpi-icon">
      <!-- users icon -->
      <svg viewBox="0 0 24 24">
        <path d="M16 11c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 3-1.34 3-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.67 0-8 1.34-8 4v2h10v-2c0-1.54.61-2.94 1.61-4H8zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 2.05 1.97 3.45v2h6v-2c0-2.66-5.33-3.5-7-3.5z"/>
      </svg>
    </div>
    <div class="kpi-content">
      <div class="kpi-title">Toplam Sporcu</div>
      <div class="kpi-value"><%= summary.TotalAthletes %></div>
    </div>
  </div>

  <!-- Riskli Sporcu -->
  <div class="kpi-card kpi-red">
    <div class="kpi-icon">
      <!-- alert icon -->
      <svg viewBox="0 0 24 24">
        <path d="M12 2L1 21h22L12 2zm1 15h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
      </svg>
    </div>
    <div class="kpi-content">
      <div class="kpi-title">Riskli Sporcu</div>
      <div class="kpi-value"><%= summary.AtRiskAthletes %></div>
    </div>
  </div>

  <!-- Ortalama Skor -->
  <div class="kpi-card kpi-green">
    <div class="kpi-icon">
      <!-- pulse icon -->
      <svg viewBox="0 0 24 24">
        <path d="M3 13h4l3-8 4 14 3-6h4"/>
      </svg>
    </div>
    <div class="kpi-content">
      <div class="kpi-title">Ortalama Skor</div>
      <div class="kpi-value"><%= summary.AvgHealthScore %></div>
    </div>
  </div>

  <!-- HaftalÄ±k DeÄŸiÅŸim -->
  <div class="kpi-card kpi-purple">
    <div class="kpi-icon">
      <!-- trend icon -->
      <svg viewBox="0 0 24 24">
        <path d="M3 17l6-6 4 4 7-7v4h2V4h-8v2h4l-5 5-4-4-7 7z"/>
      </svg>
    </div>
    <div class="kpi-content">
      <div class="kpi-title">HaftalÄ±k DeÄŸiÅŸim</div>
      <div class="kpi-value">
        <%= summary.WeeklyChangePercent %>%
      </div>
    </div>
  </div>
</div>


    <!-- CHART -->
    <div class="chart-row">
  <div class="chart-box">
    <h3>TakÄ±m Performans Trendi (7 GÃ¼n)</h3>
    <canvas id="trendChart" height="120"></canvas>
  </div>

  <div class="chart-box">
    <h3>Sporcu Durum DaÄŸÄ±lÄ±mÄ±</h3>
    <canvas id="statusDonut" height="120"></canvas>
  </div>
</div>


    <!-- TABLE -->
    <div class="table-box">
      <h3>Sporcu Listesi</h3>
      <table>
        <thead>
          <tr>
            <th>Sporcu</th>
            <th>YaÅŸ</th>
            <th>Son Skor</th>
            <th>Durum</th>
            <th>Trend</th>
            <th>Son Ã–lÃ§Ã¼m</th>
          </tr>
        </thead>
        <tbody>
          <% athletes.forEach(a=> { %>
            <tr>
              <td>
                <%= a.AthleteName %>
              </td>
              <td>
                <%= a.Age %>
              </td>
              <td>
                <%= a.LastScore %>
              </td>

              <td class="
              <%= a.Status === 'Ä°yi' ? 'status-good' :
                  a.Status === 'Orta' ? 'status-medium' :
                  'status-risk' %>">
                <%= a.Status %>
              </td>

              <td>
                <%= a.Trend==='UP' ? 'â–²' : a.Trend==='DOWN' ? 'â–¼' : 'â—' %>
              </td>

              <td>
                <%= a.LastMeasurementDate ? new Date(a.LastMeasurementDate).toLocaleDateString('tr-TR') : '-' %>
              </td>
            </tr>
            <% }) %>
        </tbody>
      </table>
    </div>

  </div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const trendData = <%- JSON.stringify(trend) %>;
  const distributionData = <%- JSON.stringify(distribution) %>;

  /* =========================
     SAFE DATE PARSE
  ========================= */
  const trendLabels = trendData.map(x => {
    const d = new Date(x.ScoreDate);
    return d.getDate() + '.' + (d.getMonth() + 1);
  });

  const teamAvg = trendData.map(x => Number(x.TeamAverage));

  // null risk varsa 0 yap
  const riskAvg = trendData.map(x =>
    x.RiskAverage !== null ? Number(x.RiskAverage) : 0
  );

  /* =========================
     LINE CHART
  ========================= */
  new Chart(document.getElementById('trendChart'), {
    type: 'line',
    data: {
      labels: trendLabels,
      datasets: [
        {
          label: 'TakÄ±m OrtalamasÄ±',
          data: teamAvg,
          borderColor: '#1f3c88',
          backgroundColor: 'rgba(31,60,136,0.1)',
          tension: 0.3,
          fill: false, // ðŸ”´ Ã–NEMLÄ°
          pointRadius: 4
        },
        {
          label: 'Riskli Sporcular',
          data: riskAvg,
          borderColor: '#c0392b',
          backgroundColor: 'rgba(192,57,43,0.1)',
          tension: 0.3,
          fill: false,
          pointRadius: 4
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'bottom'
        }
      },
      scales: {
        y: {
          min: 40,
          max: 100
        }
      }
    }
  });

  /* =========================
     DONUT CHART - STATUS
  ========================= */
  const statusLabels = distributionData.map(x => x.Status);
  const statusCounts = distributionData.map(x => x.AthleteCount);

  new Chart(document.getElementById('statusDonut'), {
    type: 'doughnut',
    data: {
      labels: statusLabels,
      datasets: [{
        data: statusCounts,
        backgroundColor: [
          '#2e8b57', // Ä°yi
          '#d97706', // Orta
          '#c0392b'  // Riskli
        ]
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'bottom'
        }
      }
    }
  });
</script>

</body>

</html>